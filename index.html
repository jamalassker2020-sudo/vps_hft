<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HFT Ultra 2026 | WebSocket Edition</title>
    <style>
        /* CSS remains largely the same for UI consistency */
        *{margin:0;padding:0;box-sizing:border-box}:root{--bg:#0a0e14;--card:#121820;--border:#1a2030;--txt:#c8d0dc;--dim:#5a6270;--g:#0f6;--r:#f44;--b:#0af;--y:#fc0}html.light{--bg:#f4f6f8;--card:#fff;--border:#dde;--txt:#1a1a2e;--dim:#888}body{background:var(--bg);color:var(--txt);font:11px/1.4 monospace;padding:8px;min-height:100vh}.g{color:var(--g)}.r{color:var(--r)}.b{color:var(--b)}.y{color:var(--y)}.dim{color:var(--dim)}.card{background:var(--card);border:1px solid var(--border);border-radius:4px;padding:8px;margin-bottom:8px}.row{display:flex;gap:8px;flex-wrap:wrap}.col{flex:1;min-width:120px}.grid{display:grid;gap:4px}.g2{grid-template-columns:repeat(2,1fr)}.g3{grid-template-columns:repeat(3,1fr)}.g4{grid-template-columns:repeat(4,1fr)}.g6{grid-template-columns:repeat(6,1fr)}.stat{background:var(--bg);padding:6px;border-radius:3px;text-align:center}.stat small{display:block;font-size:9px;color:var(--dim);margin-bottom:2px}.stat b{font-size:13px}h1{font-size:14px;margin-bottom:4px}table{width:100%;border-collapse:collapse;font-size:10px}th,td{padding:4px;text-align:right}th{color:var(--dim);font-weight:400;border-bottom:1px solid var(--border)}td:first-child,th:first-child{text-align:left}tr:hover{background:rgba(255,255,255,.02)}.scroll{max-height:200px;overflow-y:auto}.log{font-size:9px;padding:2px 4px;margin:1px 0;border-radius:2px;background:var(--bg)}button{background:var(--card);border:1px solid var(--border);color:var(--txt);padding:4px 8px;border-radius:3px;cursor:pointer;font:inherit}button:hover{background:var(--border)}.pulse{animation:p 1.5s infinite}@keyframes p{50%{opacity:.5}}.badge{display:inline-block;padding:2px 6px;border-radius:3px;font-size:9px}.badge.on{background:#0f62;color:var(--g)}.badge.off{background:#f442;color:var(--r)}.badge.warn{background:#fc02;color:var(--y)}input[type="text"]{background:var(--bg);border:1px solid var(--border);color:var(--txt);padding:4px 8px;border-radius:3px;font:inherit;width:100%;font-size:16px}
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:100}.modal{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:16px;max-width:400px;width:90%}
    </style>
</head>
<body>
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px">
        <div><h1>‚ö° HFT ULTRA <span class="dim">WS-2026</span></h1><small class="dim">REAL-TIME WEBSOCKET ENGINE ‚Ä¢ SMART RISK</small></div>
        <div class="row" style="gap:4px">
            <span id="status" class="badge pulse">INIT</span>
            <span id="api" class="badge dim">WS:OFF</span>
            <span id="webhook" class="badge dim">WH:OFF</span>
            <span id="shield" class="badge">SHIELD:--</span>
            <button onclick="showWebhookConfig()">‚öôÔ∏è</button>
            <button onclick="reset()">‚ü≤</button>
        </div>
    </div>

    <div class="grid g6" style="margin-bottom:8px">
        <div class="stat"><small>üí∞ EQUITY</small><b id="equity" class="g">$100.00</b></div>
        <div class="stat"><small>TRADES</small><b id="trades" class="b">0</b></div>
        <div class="stat"><small>WIN%</small><b id="winrate" class="y">0%</b></div>
        <div class="stat"><small>OPEN</small><b id="openPos" class="b">0/6</b></div>
        <div class="stat"><small>DD</small><b id="dd" class="r">0%</b></div>
        <div class="stat"><small>STREAK</small><b id="streak">0</b></div>
    </div>

    <div class="row">
        <div class="col" style="flex:3">
            <div class="card">
                <div class="row" style="justify-content:space-between;margin-bottom:4px"><b class="b">üìä MARKET (LIVESTREAM)</b></div>
                <div class="scroll">
                    <table>
                        <thead><tr><th>SYM</th><th>PRICE</th><th>Œî 24H</th><th>RSI</th><th>MOM</th><th>SIG</th></tr></thead>
                        <tbody id="market"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card"><b>‚ö° ACTIVITY LOG</b><div id="log" class="scroll" style="margin-top:4px"></div></div>
        </div>
    </div>

    <div id="webhookModal" class="modal-overlay" style="display:none">
        <div class="modal">
            <h3>üîó MT5 Webhook</h3>
            <input type="text" id="webhookUrl" placeholder="http://localhost:8080/webhook" style="margin-bottom:10px">
            <div class="modal-buttons"><button onclick="saveWebhookConfig()">üíæ Save</button><button onclick="closeWebhookModal()">‚úï</button></div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const SYM = [
            {s:'BTC/USDT',b:'btcusdt',p:0.01,mt5:'BTCUSD'},
            {s:'ETH/USDT',b:'ethusdt',p:0.01,mt5:'ETHUSD'},
            {s:'SOL/USDT',b:'solusdt',p:0.01,mt5:'SOLUSD'},
            {s:'BNB/USDT',b:'bnbusdt',p:0.01,mt5:'BNBUSD'},
            {s:'XRP/USDT',b:'xrpusdt',p:0.0001,mt5:'XRPUSD'}
        ];

        const C = {
            start: 100, baseLot: 0.01, tp: 15, sl: 5, trail: 6, maxPos: 6,
            maxDD: 5, cooldown: 2000, rsiPeriod: 14, minStrength: 3
        };

        let S = { bal: 100, pos: [], wins: 0, losses: 0, streak: 0, peak: 100 };
        let prices = {};
        let history = {};
        let lastTrade = {};
        let ws = null;
        let webhookConfig = { url: '', openEnabled: true, closeEnabled: true };

        // WEBSOCKET ENGINE
        function initWebSocket() {
            const streams = SYM.map(s => `${s.b}@ticker`).join('/');
            ws = new WebSocket(`wss://stream.binance.com:9443/ws/${streams}`);

            ws.onopen = () => {
                document.getElementById('api').textContent = 'WS:ON';
                document.getElementById('api').className = 'badge on';
                log("High-speed stream connected", "g");
            };

            ws.onmessage = (e) => {
                const d = JSON.parse(e.data);
                const pair = SYM.find(s => s.b === d.s.toLowerCase());
                if (!pair) return;

                // Update local price state
                const mid = (parseFloat(d.b) + parseFloat(d.a)) / 2;
                prices[pair.s] = {
                    bid: parseFloat(d.b),
                    ask: parseFloat(d.a),
                    mid: mid,
                    change24: d.P,
                    pip: pair.p
                };

                updateHistory(pair.s, mid);
                tradeLogic(pair.s); // Run logic every tick
            };

            ws.onclose = () => {
                document.getElementById('api').className = 'badge off';
                setTimeout(initWebSocket, 5000); // Auto-reconnect
            };
        }

        function updateHistory(sym, price) {
            if (!history[sym]) history[sym] = [];
            history[sym].push(price);
            if (history[sym].length > 50) history[sym].shift();
        }

        // CALCULATION LOGIC
        function calcRSI(sym) {
            const h = history[sym];
            if (!h || h.length < C.rsiPeriod) return 50;
            let g = 0, l = 0;
            for (let i = 1; i < h.length; i++) {
                let d = h[i] - h[i-1];
                d > 0 ? g += d : l -= d;
            }
            return l === 0 ? 100 : 100 - (100 / (1 + (g / l)));
        }

        // CORE TRADING
        function tradeLogic(sym) {
            const p = prices[sym];
            if (!p || S.pos.length >= C.maxPos) return;

            const rsi = calcRSI(sym);
            const now = Date.now();

            if (lastTrade[sym] && now - lastTrade[sym] < C.cooldown) return;

            let sig = null;
            if (rsi < 25) sig = 'BUY';
            if (rsi > 75) sig = 'SELL';

            if (sig) {
                const entry = sig === 'BUY' ? p.ask : p.bid;
                const pos = {
                    id: 'HFT-' + Math.random().toString(36).substr(2,5).toUpperCase(),
                    sym, type: sig, entry, pip: p.pip,
                    tp: sig === 'BUY' ? entry + (C.tp * p.pip) : entry - (C.tp * p.pip),
                    sl: sig === 'BUY' ? entry - (C.sl * p.pip) : entry + (C.sl * p.pip),
                    pipValue: C.baseLot * 10,
                    time: now
                };
                S.pos.push(pos);
                lastTrade[sym] = now;
                sendWebhook('OPEN', pos);
                log(`üöÄ ${sig} ${sym} @ ${entry.toFixed(4)}`, 'b');
            }
            manageExits();
        }

        function manageExits() {
            S.pos.forEach((pos, i) => {
                const p = prices[pos.sym];
                if (!p) return;
                const cur = pos.type === 'BUY' ? p.bid : p.ask;
                const pips = pos.type === 'BUY' ? (cur - pos.entry) / pos.pip : (pos.entry - cur) / pos.pip;
                
                let close = false;
                if (pos.type === 'BUY' && (cur >= pos.tp || cur <= pos.sl)) close = true;
                if (pos.type === 'SELL' && (cur <= pos.tp || cur >= pos.sl)) close = true;

                if (close) {
                    const pnl = pips * pos.pipValue;
                    S.bal += pnl;
                    pnl > 0 ? S.wins++ : S.losses++;
                    sendWebhook('CLOSE', {...pos, pnl});
                    log(`üèÅ CLOSE ${pos.sym}: $${pnl.toFixed(2)}`, pnl > 0 ? 'g' : 'r');
                    S.pos.splice(i, 1);
                }
            });
        }

        // WEBHOOKS & UI
        async function sendWebhook(action, data) {
            if (!webhookConfig.url) return;
            fetch(webhookConfig.url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action, ...data})
            }).catch(e => console.error("Webhook Failed"));
        }

        function renderUI() {
            document.getElementById('equity').textContent = '$' + S.bal.toFixed(2);
            document.getElementById('trades').textContent = S.wins + S.losses;
            document.getElementById('openPos').textContent = `${S.pos.length}/${C.maxPos}`;
            
            let h = '';
            SYM.forEach(s => {
                const p = prices[s.s] || {mid:0, change24:0};
                const rsi = Math.round(calcRSI(s.s));
                h += `<tr>
                    <td>${s.s}</td>
                    <td>${p.mid.toFixed(2)}</td>
                    <td class="${p.change24 > 0 ? 'g' : 'r'}">${p.change24}%</td>
                    <td>${rsi}</td>
                    <td>--</td>
                    <td class="${rsi < 30 ? 'g' : rsi > 70 ? 'r' : ''}">${rsi < 30 ? 'BUY' : rsi > 70 ? 'SELL' : '--'}</td>
                </tr>`;
            });
            document.getElementById('market').innerHTML = h;
        }

        function log(m, c) {
            const l = document.getElementById('log');
            const e = document.createElement('div');
            e.className = `log ${c}`;
            e.innerHTML = `<span class="dim">[${new Date().toLocaleTimeString()}]</span> ${m}`;
            l.prepend(e);
        }

        function showWebhookConfig() { document.getElementById('webhookModal').style.display = 'flex'; }
        function closeWebhookModal() { document.getElementById('webhookModal').style.display = 'none'; }
        function saveWebhookConfig() { 
            webhookConfig.url = document.getElementById('webhookUrl').value; 
            closeWebhookModal();
            log("Webhook URL Updated", "b");
        }
        function reset() { location.reload(); }

        // START ENGINE
        initWebSocket();
        setInterval(renderUI, 500); // Smooth UI updates
    </script>
</body>
</html>
