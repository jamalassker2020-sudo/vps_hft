<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HFT Ultra FX 2026 - Railway Connected</title>
<style>
/* All your CSS styles remain the same */
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0e14;--card:#121820;--border:#1a2030;--txt:#c8d0dc;--dim:#5a6270;--g:#0f6;--r:#f44;--b:#0af;--y:#fc0;--gold:#ffd700}
html.light{--bg:#f4f6f8;--card:#fff;--border:#dde;--txt:#1a1a2e;--dim:#888}
body{background:var(--bg);color:var(--txt);font:11px/1.4 monospace;padding:8px;min-height:100vh}
.g{color:var(--g)}.r{color:var(--r)}.b{color:var(--b)}.y{color:var(--y)}.dim{color:var(--dim)}.gold{color:var(--gold)}
.card{background:var(--card);border:1px solid var(--border);border-radius:4px;padding:8px;margin-bottom:8px}
.row{display:flex;gap:8px;flex-wrap:wrap}
.col{flex:1;min-width:120px}
.grid{display:grid;gap:4px}
.g2{grid-template-columns:repeat(2,1fr)}.g3{grid-template-columns:repeat(3,1fr)}.g4{grid-template-columns:repeat(4,1fr)}.g6{grid-template-columns:repeat(6,1fr)}
.stat{background:var(--bg);padding:6px;border-radius:3px;text-align:center}
.stat small{display:block;font-size:9px;color:var(--dim);margin-bottom:2px}
.stat b{font-size:13px}
h1{font-size:14px;margin-bottom:4px}
table{width:100%;border-collapse:collapse;font-size:10px}
th,td{padding:4px;text-align:right}
th{color:var(--dim);font-weight:400;border-bottom:1px solid var(--border)}
td:first-child,th:first-child{text-align:left}
tr:hover{background:rgba(255,255,255,.02)}
.scroll{max-height:200px;overflow-y:auto}
.bar{height:40px;display:flex;align-items:end;gap:1px}
.bar div{flex:1;min-width:2px;border-radius:1px 1px 0 0}
.log{font-size:9px;padding:2px 4px;margin:1px 0;border-radius:2px;background:var(--bg)}
button{background:var(--card);border:1px solid var(--border);color:var(--txt);padding:4px 8px;border-radius:3px;cursor:pointer;font:inherit}
button:hover{background:var(--border)}
.pulse{animation:p 1.5s infinite}@keyframes p{50%{opacity:.5}}
.badge{display:inline-block;padding:2px 6px;border-radius:3px;font-size:9px}
.badge.on{background:#0f62;color:var(--g)}.badge.off{background:#f442;color:var(--r)}.badge.warn{background:#fc02;color:var(--y)}.badge.gold{background:#ffd7002a;color:var(--gold)}
input[type="text"]{background:var(--bg);border:1px solid var(--border);color:var(--txt);padding:4px 8px;border-radius:3px;font:inherit;width:100%;font-size:16px}
input[type="text"]:focus{outline:none;border-color:var(--b)}
.webhook-status{font-size:9px;margin-top:4px}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;align-items:center;justify-content:center;z-index:100}
.modal{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:16px;max-width:400px;width:90%}
.modal h3{margin-bottom:12px;font-size:14px}
.modal-buttons{display:flex;gap:8px;justify-content:flex-end;margin-top:16px}
.profit-bar{height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin-top:4px}
.profit-bar-fill{height:100%;transition:width 0.3s;border-radius:3px}
.lock-flash{animation:lockFlash 0.5s ease-out}
@keyframes lockFlash{0%{background:var(--gold);transform:scale(1.05)}100%{background:var(--bg);transform:scale(1)}}
@media(max-width:600px){.g6{grid-template-columns:repeat(3,1fr)}.g4{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>
<div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px">
<div>
<h1>‚ö° HFT ULTRA <span class="y">FX</span> <span class="gold">RAILWAY CONNECTED</span> <span class="dim">2026</span></h1>
<small class="dim">28 PAIRS ‚Ä¢ ACCUMULATING PROFIT LOCK ‚Ä¢ TIERED TRAILS ‚Ä¢ BREAK-EVEN LOCK</small>
</div>
<div class="row" style="gap:4px">
<span id="status" class="badge pulse">INIT</span>
<span id="mode" class="badge">MODE:--</span>
<span id="api" class="badge dim">API:--</span>
<span id="webhook" class="badge dim">WH:--</span>
<span id="shield" class="badge">SHIELD:--</span>
<button onclick="showWebhookConfig()">‚öôÔ∏è</button>
<button onclick="reset()">‚ü≤</button>
</div>
</div>

<!-- ... (ALL YOUR HTML UI CODE REMAINS THE SAME) ... -->

<script>
// =====================================================
// WEBHOOK CONFIGURATION - PRE-CONFIGURED FOR RAILWAY
// =====================================================
let webhookConfig = {
  // Your Railway URL - ALREADY CONFIGURED
  url: 'https://vpshft-production.up.railway.app/webhook',
  secret: '',
  openEnabled: true,
  closeEnabled: true,
  lastStatus: null,
  sentCount: 0,
  errorCount: 0
};

// Modified sendWebhook function for Railway
async function sendWebhook(action, tradeData) {
  if (!webhookConfig.url) return;
  if (action === 'OPEN' && !webhookConfig.openEnabled) return;
  if (action === 'CLOSE' && !webhookConfig.closeEnabled) return;

  const symData = SYM.find(s => s.s === tradeData.sym);
  
  const payload = {
    action: action,
    source: "HFT-ULTRA-FX-RAILWAY-2026",
    version: "2.0",
    timestamp: new Date().toISOString(),
    timestamp_unix: Date.now(),
    trade_id: tradeData.id || generateTradeId(),
    symbol: tradeData.sym,
    symbol_mt5: symData?.mt5 || tradeData.sym.replace('/', ''),
    direction: tradeData.type,
    order_type: tradeData.type === 'BUY' ? 0 : 1,
    entry_price: tradeData.entry,
    current_price: tradeData.currentPrice || tradeData.entry,
    take_profit: tradeData.tp,
    stop_loss: tradeData.sl,
    trailing_stop: tradeData.trail || null,
    lot_size: tradeData.lot,
    pip_value: tradeData.pipValue,
    pip_size: tradeData.pip,
    signal_strength: tradeData.strength || 0,
    exit_price: action === 'CLOSE' ? tradeData.exitPrice : null,
    exit_reason: action === 'CLOSE' ? tradeData.reason : null,
    pnl_pips: action === 'CLOSE' ? tradeData.pips : null,
    pnl_usd: action === 'CLOSE' ? tradeData.pnl : null,
    duration_ms: action === 'CLOSE' ? (Date.now() - tradeData.time) : null
  };

  try {
    // For Railway HTTPS
    const response = await fetch(webhookConfig.url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Signal-Source': 'HFT-ULTRA-FX-RAILWAY',
        'X-Signal-Action': action,
        'Accept': 'application/json'
      },
      body: JSON.stringify(payload),
      mode: 'cors', // Railway supports CORS
      cache: 'no-cache'
    });

    if (response.ok) {
      webhookConfig.sentCount++;
      webhookConfig.lastStatus = 'OK';
      log(`‚úÖ WH ${action}: ${tradeData.sym}`, 'g');
    } else {
      throw new Error(`HTTP ${response.status}`);
    }
  } catch (err) {
    webhookConfig.errorCount++;
    webhookConfig.lastStatus = 'ERR';
    console.log('Webhook error:', err.message);
    if (webhookConfig.errorCount <= 3) {
      log(`‚ö†Ô∏è WH Error: ${err.message}`, 'y');
    }
  }
}

// Test function for Railway
async function testWebhook() {
  const url = document.getElementById('webhookUrl').value.trim() || webhookConfig.url;
  const resultEl = document.getElementById('webhookTestResult');
  
  if (!url) {
    resultEl.innerHTML = '<span class="r">‚ùå Please enter a webhook URL</span>';
    return;
  }

  resultEl.innerHTML = '<span class="y">üîÑ Testing Railway connection...</span>';

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-Signal-Source': 'HFT-ULTRA-FX-TEST',
        'X-Signal-Action': 'TEST'
      },
      body: JSON.stringify({
        action: 'TEST',
        source: 'HFT Ultra FX Railway Bot',
        timestamp: new Date().toISOString(),
        message: 'Testing connection to Railway server'
      }),
      mode: 'cors'
    });

    if (response.ok) {
      const data = await response.text();
      resultEl.innerHTML = '<span class="g">‚úÖ Railway connection successful!</span>';
      log('‚úÖ Railway webhook test passed', 'g');
    } else {
      resultEl.innerHTML = `<span class="r">‚ùå Railway Error: ${response.status}</span>`;
    }
  } catch (err) {
    resultEl.innerHTML = `<span class="r">‚ùå ${err.message}</span>`;
    log(`‚ùå Railway test failed: ${err.message}`, 'r');
  }
}

// Rest of your JavaScript code remains the same...
// (All the trading logic, indicators, profit lock system, etc.)

// At the end of init() function, add Railway status:
async function init(){
  // ... existing init code ...
  
  if(webhookConfig.url.includes('railway')){
    log('üöÇ Connected to Railway: ' + webhookConfig.url, 'b');
    log('üì° Sending signals to MT5 via Railway', 'g');
  }
}

// Start the bot
init();
</script>
</body>
</html>
